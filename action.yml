name: "GH Recent Activity Widget"
description: "ğŸ“ Inject your README with a nicely formatted history of your github interactions"
author: "FreddyMSchubert <github@frederickschubert.de>"
branding:
  icon: "activity"
  color: "blue"

inputs:
  github_token:
    description: "GitHub token (GITHUB_TOKEN or PAT with `repo` & `read:org`)"
    required: true
    default: ${{ github.token }}

  username:
    description: "GitHub user to fetch events for"
    required: true

  max_items:
    description: "Max number of events to render"
    required: false
    default: "5"

  event_templates:
    description: |
      JSON mapping of event keys â†’ template strings.
      - **Keys** can be:
        â€¢ **Normalized types** (e.g. `issues_opened`, `pr_merged`, `push`, `release`)  
        â€¢ **Raw GitHub event names** (e.g. `IssuesEvent`, `PushEvent`, `ReleaseEvent`)  
      - **Values** are JS-templated strings (`{{â€¦}}` executes JS).  
      - Missing or `""` = skip that event.  
      ```json
      {
        "IssuesEvent": "{{index}}. ğŸ”– New issue #{{payload.issue.number}} in {{repo}}",
        "pr_merged": "{{emoji}} Merged PR #{{number}} on {{created_at}}"
      }
      ```
    required: false
    default: |
      {
        "IssuesEvent":   "{{index}}. âš ï¸ New issue #{{payload.issue.number}}: {{payload.issue.title}}",
        "issues_closed": "{{index}}. ğŸ”¥ Closed issue #{{number}} by {{actor}}",
        "PushEvent":     "{{index}}. ğŸš€ Pushed {{payload.size}} commits to {{payload.ref}}",
        "release":       "{{index}}. ğŸ“¡ Released {{payload.release.tag_name}} ({{payload.release.prerelease ? 'pre' : ''}}release)",
        "fork":          "{{index}}. ğŸ´ Forked repo to {{payload.forkee.full_name}}",
        "public":        "{{index}}. ğŸ¸ Made {{repo}} public"
      }

  readme_path:
    description: "Path to README file"
    required: false
    default: "README.md"

runs:
  using: "composite"
  steps:
    - name: Install dependencies ğŸ”§
      shell: bash
      run: |
        echo "Installing dependencies for action..."
        cd "$GITHUB_ACTION_PATH"
        npm install --production

    - name: Run activity script ğŸš€
      shell: bash
      run: |
        cd "$GITHUB_ACTION_PATH"
        node src/index.js
      env:
        INPUT_GITHUB_TOKEN: ${{ inputs.github_token }}
        INPUT_USERNAME: ${{ inputs.username }}
        INPUT_MAX_ITEMS: ${{ inputs.max_items }}
        INPUT_EVENT_TEMPLATES: ${{ inputs.event_templates }}
        INPUT_README_PATH: ${{ inputs.readme_path }}

permissions:
  contents: write
